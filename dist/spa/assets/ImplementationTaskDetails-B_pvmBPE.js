import{a6 as de,a7 as Me,al as j,a8 as N,a9 as w,aa as b,ac as p,ae as Ie,af as u,ag as $,am as P,ab as S,ah as Se,ao as Q,aj as ue,E as W,au as x,a3 as Ne,ay as G,U as oe,aB as B,T as d,ax as F,Q as ae,az as Ge,aq as Te,ar as qe,aM as It,ak as St,O as re}from"./index-pp-zxjmJ.js";import{Q as ne,u as me}from"./dark-mode-T9Pt6Rb6.js";import{L as Nt}from"./ListQTable-0eXUoj3b.js";import{u as Ee}from"./use-quasar-DTO4IyFR.js";import{Q as De}from"./QCardSection-CGtarS5O.js";import{Q as Gt}from"./QCard-B8NG_d02.js";import{Q as Et}from"./QDialog-Fsjl9-tV.js";import{S as Ae}from"./SearchModel-Bs5n-Zcw.js";import{C as At,D as Ot}from"./Requirement-B688Mj4F.js";import{C as Pt,D as Vt,U as jt}from"./ImplementationTaskRequirement-Rvu9Kw-i.js";import{R as $t}from"./Requirement-CtssbQqP.js";import{s as I}from"./search-DiX5JiHP.js";import{Q as Qt}from"./QCardDetails-D49YX1Ie.js";import{B as Lt}from"./BasicAttachModal-BLg4Q69X.js";import{u as _t,s as Ut}from"./pinia-H8VF6y17.js";import{a as Bt}from"./AdminImplementationTask-D8FtUr2c.js";import{I as Ft}from"./Introspection-B6PnXNiS.js";import{D as Wt,a as zt,U as Ht,R as xt,M as Yt}from"./ImplementationTask-CUm9oAYG.js";import{S as Jt}from"./Skill-CTT8F4a2.js";import{c as Kt,b as Xt,e as Zt}from"./searchStore-yxtnVXNf.js";import{P as eo}from"./ProjectProcess-zsbTZxjQ.js";import{I as to}from"./ImplementationGuideline-Bg-wc_a0.js";import{Q as oo}from"./QMarkupTable-CXcSwnxR.js";import{d as ao}from"./vuedraggable.umd-DAVuxstj.js";import"./use-key-composition-CnPM_xP4.js";import"./index-Cy3PLz-a.js";import"./parser-D6bCODxJ.js";import"./QSelect-wdHiNoA7.js";import"./QChip-C6yMxZyV.js";import"./QItemLabel-DjguDHTb.js";import"./QToggle-CCqmYG-z.js";import"./ClosePopup-Bou3snqx.js";import"./QPagination-DMGZXcC_.js";import"./QSkeleton-Df1Ie8vx.js";import"./QSeparator-BsnedQuX.js";import"./QResizeObserver-B57LBLtT.js";import"./QScrollObserver-D-e6ZeCm.js";import"./touch-BjYP5sR0.js";import"./QCardActions-SjhS8Jl0.js";import"./QFile-DVKXt7mC.js";const no=Me({components:{SearchModel:Ae},props:{cardAddMode:{type:String,default:""},showComponentModal:{type:Boolean,default:!1},setComponentModal:{type:Function,default:()=>{}},pushNewResponseData:{type:Function,default:()=>{}},fetchRequirements:{type:Function,default:()=>{}},taskName:{type:String,default:""},createOnly:{type:Boolean,default:!1}},setup(t){const o=ue(),v=W(()=>parseInt(o.params.id)),i=W(()=>me().darkmode),r=x({name:"",description:"",componentId:null,showModal:!1,discoveryQuestion:"",responseType:"Boolean",isCreateNew:!1,componentSearch:"",isMenuOpen:!1,page:1,showSpinner:!1,previousRequirementIds:[],shouldResetSearch:!1}),a=W(()=>r.name==="");Ne(()=>{r.showModal=!0,r.shouldResetSearch=!r.shouldResetSearch,I.setPage(1),I.setSearch("")});const{mutate:h,onDone:l}=G(At,()=>({variables:{Name:r.name,ResponseType:r.responseType,Description:r.description}}));l(m=>{t.fetchRequirements(),n(m.data.CreateRequirementMutation)});const{mutate:y,onDone:T,onError:L}=G(Pt,()=>({variables:{implementation_task_id:parseInt(o.params.id),requirement_id:r.componentId}}));L(m=>{console.log(m,"ERROR req")}),T(m=>{console.log(m,"DONE"),t.fetchRequirements(),t.pushNewResponseData(m.data.CreateImplementationTaskRequirement),n(m.data.CreateImplementationTaskRequirement.Requirement)});const D=Ee();function n(m){D.notify({spinner:!0,message:"Requirement Added: "+m.Name,timeout:2e3,color:"indigo-9"})}function R(m,C){r.componentId===null?h():y(),setTimeout(()=>{C!=="another"&&(r.showModal=!1,t.setComponentModal(!1),r.shouldResetSearch=!r.shouldResetSearch)},1e3),C==="another"?document.body.style.cursor="wait":setTimeout(()=>{t.setComponentModal(!1),r.showModal=!1,r.shouldResetSearch=!r.shouldResetSearch,document.body.style.cursor="wait"},1e3),setTimeout(()=>{document.body.style.cursor="default"},1001)}function c(m){m!=="close"&&(r.name=m,m._id&&(r.componentId=m._id,r.isCreateNew=!1))}oe(()=>I.getState.search,()=>{r.name=I.getState.search});const{result:E,loading:q}=B($t,()=>({page:I.getState.page,Name:I.getState.search,first:15,implementation_task_id:v.value,filterOutAllTaskRequirements:!0})),M=d(!1),f=d([]),k=d("");return F(()=>{if(q.value&&(M.value=!0),I.getState.search!==k.value&&(M.value=!0,f.value=[],k.value=I.getState.search),E.value){M.value=!1;let m=f.value;const C=E.value.Requirements.data.filter(Y=>!f.value.some(_=>_._id===Y._id));I.getState.page>1?f.value=[...f.value,...C]:f.value=[...C,...f.value],I.setSpinner(f.value,m)}}),I.onSetValueCallback(c),{state:r,createSowComponent:R,disableCreate:a,route_id:v,createRequirement:h,setRequirementId:c,requirements:f,isLoadingRequirements:M,darkmode:i}}}),lo={class:"text-xl mt-0 mb-1 text-center"},so={style:{width:"100%"}},io={class:"flex flex-col justify-end mr-3"},ro={key:0,class:"mb-3 text-center text-slate-600",style:{"font-weight":"500"}},uo={class:"dark:text-slate-300"},mo={style:{position:"absolute",right:"0px",bottom:"1rem"}};function co(t,o,v,i,r,a){const h=j("SearchModel");return w(),N(Et,{modelValue:t.state.showModal,"onUpdate:modelValue":o[5]||(o[5]=l=>t.state.showModal=l),onHide:o[6]||(o[6]=l=>t.setComponentModal(!1))},{default:b(()=>[p(Gt,{class:Ie(["container intro-y box",t.darkmode?"bg-[#28334E] text-slate-300":""]),style:{"overflow-y":"hidden"}},{default:b(()=>[p(De,{class:"col flex flex-col mb-0 pb-0",style:{"overflow-y":"hidden"}},{default:b(()=>[u("p",lo,$(t.state.createNew?"Create":"Attach")+" Requirement ",1),o[7]||(o[7]=u("hr",{style:{width:"100%"},class:"dark:border-slate-500"},null,-1))]),_:1}),p(De,{class:"items-center"},{default:b(()=>[u("div",null,[u("div",so,[u("div",io,[t.createOnly?S("",!0):(w(),P("p",ro,[o[8]||(o[8]=u("span",{class:"mr-2"},"Associated Task:",-1)),o[9]||(o[9]=Se()),u("span",uo,$(t.taskName),1)])),t.state.isCreateNew?(w(),N(ne,{key:2,id:"validation-form-5",modelValue:t.state.name,"onUpdate:modelValue":o[0]||(o[0]=l=>t.state.name=l),modelModifiers:{trim:!0},filled:"",class:"form-control detail-input",name:"details",dark:t.darkmode,placeholder:"Requirement Name",borderless:""},null,8,["modelValue","dark"])):(w(),N(h,{key:1,label:"Requirements",rows:t.requirements,loading:t.isLoadingRequirements,class:"w-full",filled:"","no-focus":"",resetSearch:t.state.shouldResetSearch},null,8,["rows","loading","resetSearch"])),t.state.isCreateNew||t.createOnly?(w(),N(ne,{key:3,id:"validation-form-6",modelValue:t.state.description,"onUpdate:modelValue":o[1]||(o[1]=l=>t.state.description=l),modelModifiers:{trim:!0},filled:"",dark:t.darkmode,class:"form-control detail-input q-my-md",name:"details",placeholder:"Description",borderless:""},null,8,["modelValue","dark"])):S("",!0)])]),o[10]||(o[10]=u("div",{class:"mt-14"},null,-1)),u("div",mo,[p(Q,{dense:"",class:"save-btn mr-8 font-regular","no-caps":"",flat:"",label:t.state.componentId||t.state.isCreateNew?"Add Another":"Cancel",color:t.darkmode?"grey-5":"grey-8",onClick:o[2]||(o[2]=l=>t.state.componentId||t.state.isCreateNew?t.createSowComponent(t.cardAddMode,"another"):t.state.showModal=!1)},null,8,["label","color"]),p(Q,{dense:"",class:"save-btn q-px-md",style:{"margin-right":"1.5rem","margin-left":"0rem"},"no-caps":"",icon:t.state.isCreateNew?"close":"add",label:"Create New",color:t.state.isCreateNew?"red-4":"blue-grey",onClick:o[3]||(o[3]=l=>t.state.isCreateNew=!t.state.isCreateNew)},null,8,["icon","color"]),p(Q,{dense:"",disable:t.disableCreate,class:"save-btn q-px-md",style:{"margin-right":"1.5rem","margin-left":"0rem"},"no-caps":"",label:t.state.isCreateNew?"Create & Close":"Save & Close",color:"primary",onClick:o[4]||(o[4]=l=>t.createSowComponent(t.cardAddMode,"close"))},null,8,["disable","label"])])])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue"])}const po=de(no,[["render",co],["__scopeId","data-v-68143221"]]),fo={components:{draggable:ao},props:{title:{type:String,required:!0},rows:{type:Array,required:!0},handleRowClick:{type:Function,default:()=>{}},updateComponentOrder:{type:Function,default:()=>{}},idValue:{type:String,default:"_id"},headerTooltip:{type:String,default:""}},setup(t){const o=me(),v=W(()=>o.darkMode),i=d([]),r=x({page:1,allowDrag:!1});function a(n){console.log(n,"setAllowDrag"),r.allowDrag=n}Ne(()=>{i.value=t.rows});const h=ue();oe(()=>t.rows,()=>{console.log(t.rows,h,"rows just changed markup table"),i.value=t.rows}),oe(()=>i.value,()=>{console.log(i.value,"componentRows markup table")});let l=null;function y(n){console.log(n,"onUpdateOrder event"),l&&clearTimeout(l),console.log("update this row",n.moved.element.Name,"toNewIndex: ",(n.moved.newIndex+1)*10),l=setTimeout(()=>{console.log(i.value,"componentRows.value"),t.updateComponentOrder(n.moved.element,(n.moved.newIndex+1)*10),l=null},1e3)}const T=d({});function L(n,R,c,E){console.log(c,"event"),c.preventDefault(),T.value={id:n,row:R,event:c};const q=c.clientX,M=c.clientY;document.querySelector(".context-menu")&&D();const f=document.createElement("div");f.className="context-menu",f.innerHTML=`
      <div class="text-gray-600 bg-white text-weight-regular py-1 rounded-md w-56" style="font-size: .75rem; z-index: 1000">
        <div class="hover:bg-zinc-100 px-4 py-1.5 open-in-new-tab" style="transform: scale(1, .95);">Open link in new tab</div>
        <div class="hover:bg-zinc-100 px-4 py-1.5 open-in-new-window" style="transform: scale(1, .95);">Open link in new window</div>
        <div class="hover:bg-zinc-100 px-4 py-1.5 open-in-new-incognito-window" style="transform: scale(1, .95);">Open link in new incognito window</div>
      </div>
        `;let k=E?q-240:q;f.style.position="fixed",f.style.top=`${M}px`,f.style.left=`${k}px`,document.body.appendChild(f),f.addEventListener("click",function(m){m.target.classList.contains("open-in-new-tab")?(t.handleRowClick(T.value.id,T.value.row,"openNewTab"),D()):m.target.classList.contains("open-in-new-window")?(t.handleRowClick(T.value.id,T.value.row,"openNewWindow"),D()):(m.target.classList.contains("open-in-new-incognito-window")&&t.handleRowClick(T.value.id,T.value.row,"openIncognitoWindow"),D())})}document.addEventListener("click",n=>{const R=document.querySelector(".context-menu");R&&!R.contains(n.target)&&D()});function D(){const n=document.querySelector(".context-menu");n&&n.parentNode&&n.parentNode.removeChild(n)}return{state:r,drag:!1,onUpdateOrder:y,componentRows:i,darkmode:v,showContextMenu:L,setAllowDrag:a}}},go={class:"q-py-md"},ho={class:"text-xl pl-3 pt-4 q-ml-md absolute top-0 z-10"},ko={style:{"white-space":"pre-line"}},wo={class:"w-full mt-14"},vo={class:"grid grid-cols-5 w-full relative -pr-20"},yo={class:"col-span-3 text-left flex no-wrap items-center"},Ro=["onClick","onContextmenu"],Co={class:"flex items-center justify-end"},bo={class:"flex justify-end"};function To(t,o,v,i,r,a){const h=j("draggable");return w(),P("div",go,[p(oo,{class:"pt-14 dark:bg-[#28334E] dark:text-slate-300 dark:shadow-md",dark:i.darkmode},{default:b(()=>[u("div",ho,[Se($(v.title)+" ",1),v.headerTooltip!==""?(w(),N(ae,{key:0,name:"help",size:"xs",class:"ml-4 text-slate-500 hover:text-blue-400 transition-all duration-500"},{default:b(()=>[p(Ge,{class:"text-sm bg-white shadow-md border text-slate-600 hover:text-blue-400"},{default:b(()=>[u("p",ko,$(v.headerTooltip),1)]),_:1})]),_:1})):S("",!0)]),u("tbody",wo,[o[5]||(o[5]=u("thead",{class:"grid grid-cols-3 mr-0 pr-0 w-full"},[u("th",{class:"text-left"},"Requirements"),u("th",{class:"text-right"},"Description"),u("th",{class:"text-right"},"Actions")],-1)),p(h,{modelValue:i.componentRows,"onUpdate:modelValue":o[2]||(o[2]=l=>i.componentRows=l),group:"people","item-key":"id",disabled:!i.state.allowDrag,onStart:o[3]||(o[3]=l=>i.drag=!0),onEnd:o[4]||(o[4]=l=>i.drag=!1),onChange:i.onUpdateOrder},{item:b(({element:l})=>[u("tr",vo,[u("td",yo,[p(ae,{name:"drag_indicator",class:"hover:text-blue-500 cursor-move mr-2",size:"xs",onMouseover:o[0]||(o[0]=y=>i.setAllowDrag(!0)),onMouseleave:o[1]||(o[1]=y=>i.setAllowDrag(!1))}),u("p",{class:"text-weight-medium cursor-pointer",style:{"white-space":"normal"},onClick:y=>v.handleRowClick(l[v.idValue],l,y),onContextmenu:y=>i.showContextMenu(l[v.idValue],l,y)},$(l.Name),41,Ro)]),u("td",Co,$(l.Description??"N/A"),1),u("td",bo,[p(Q,{label:"View","icon-right":"visibility",dense:"","no-caps":"",flat:"",color:"primary",onClick:y=>v.handleRowClick(l[v.idValue],l,y),onContextmenu:y=>i.showContextMenu(l[v.idValue],l,y)},null,8,["onClick","onContextmenu"]),p(Q,{icon:"do_not_disturb_on",dense:"","no-caps":"",flat:"",color:"blue-grey",onClick:y=>v.handleRowClick("delete",l)},null,8,["onClick"])])])]),_:1},8,["modelValue","disabled","onChange"])])]),_:1},8,["dark"])])}const qo=de(fo,[["render",To]]),Do=Me({components:{ListQTable:Nt,CreateRequirementModal:po,QCardDetails:Qt,BasicAttachModal:Lt,SearchModel:Ae,MarkupQTable:qo},setup(){const t=_t(Ut);function o(){t.setSowID(null)}const v=W(()=>me().darkmode),i=ue(),r=St(),a=x({search:"",searchGuideline:"",name:"",blockHours:null,isRecurring:!1,skillName:"",createdAt:"",taskType:"",isCustomerTask:!1,projectProcessName:"",id:i.query.id,showSkillModal:!1,showTaskModal:!1,showUpdateTaskModal:!1,limit:15,page:1,guideline_id:i.query.id,editMode:!1,project_process_id:null,skill_id:null,showRequirementModal:!1,confirmDelete:!1,selectedRequirement:null,showUpdateRequirementModal:!1,confirmDeleteRequirement:!1,showGuidelineModal:!1,selectedGuidelineID:null,relatedModel:null,guidelineActionType:null,relatedName:"",showComponentType:"all"}),h=Ee(),l=re("windowWidth"),y=d({});function T(e){a.showTaskModal=e}function L(){a.id=i.query.id}L();function D(e){a.showSkillModal=e}function n(e){a.page=e}const R=Kt(),c=Xt(),E=Zt(),{result:q,refetch:M,error:f}=B(Bt,()=>({_id:i.params.id})),k=d([]),m=d([]),C=d([]),Y=d(!0);F(()=>{f.value&&console.log(JSON.stringify(f.value,null,2)),q.value&&(k.value={...q.value.AdminImplementationTask,ProjectProcess:q.value.AdminImplementationTask.ProjectProcess&&q.value.AdminImplementationTask.ProjectProcess.Name},Y.value=!1,k.value.IsDeprecated||delete k.value.IsDeprecatedReason,a.name=k.value.Name,a.blockHours=k.value.BlockHours,a.isRecurring=k.value.IsRecurring,a.skillName=k.value.SkillName,a.createdAt=k.value.created_at,a.taskType=k.value.TaskType,a.isCustomerTask=k.value.isCustomerTask,a.projectProcessName=k.value.ProjectProcess&&k.value.ProjectProcess.Name,a.skill_id=k.value.skill_id,a.project_process_id=k.value.project_process_id,console.log(q.value,"  implementationGuidelineTasks.value"),m.value=q.value.AdminImplementationTask.AdminImplementationGuidelines,C.value.length===0&&(C.value=q.value.AdminImplementationTask.ImplementationTaskRequirements.map(e=>({...e.Requirement,...e}))))});const{result:_,error:ce}=B(Ft,()=>({name:"ImplementationTask"})),le=d([]);F(()=>{ce.value&&console.log(JSON.stringify(ce.value,null,2)),_.value&&(_.value.__type.fields.map(e=>{e.description!==null&&le.value.push(e)}),_.value.__type.description.includes("Confluence")&&le.value.push({name:"Confluence Article",description:_.value.__type.description.substring(19,_.value.__type.description.length)}))});const{mutate:Oe,onDone:Pe}=G(Wt,()=>({variables:{_id:i.params.id}})),{mutate:Ve,onDone:je}=G(zt,()=>({variables:{_id:a.deletedTaskID}})),J=d(!1);function $e(e){J.value=!0,a.deletedTaskID=e,Ve()}Pe(e=>{h.notify({message:"Implementation Task Deleted: "+e.data.DeleteImplementationTaskMutation.Name,color:"primary",icon:"delete",timeout:6e3,actions:[{label:"Undo",color:"white",handler:()=>$e(e.data.DeleteImplementationTaskMutation._id)}]}),setTimeout(()=>{J.value||h.loading.show({delay:200,message:"Redirecting to Implementation Tasks",spinnerSize:100,spinnerColor:"primary",messageColor:"white",backgroundColor:"primary"})},6e3),setTimeout(()=>{J.value||(h.loading.hide(),r.push("/implementation-tasks")),J.value=!1},7e3)}),je(e=>{console.log("onDoneRestoreImplementationTask",e),h.notify({message:"Implementation Task Restored: "+e.data.RestoreImplementationTaskMutation.Name,color:"green",icon:"redo",timeout:8e3})});function pe(){Oe()}const z=x([{name:"name",align:"left",label:"Requirements",field:e=>e.Name,format:e=>`${e}`},{name:"description",required:!0,label:"Description",align:"left",field:e=>e.Description,format:e=>`${e}`},{name:"attachment",required:!0,label:"Actions",align:"right"}]),Qe=()=>{if(l.value<=700){const e=z.findIndex(s=>s.name==="description");e!==-1&&z.splice(e,1)}else z.find(s=>s.name==="description")||z.splice(1,0,{name:"description",required:!0,label:"Description",align:"left",field:s=>s.Description,format:s=>`${s}`,sortable:!0})},{mutate:Le,onError:_e,onDone:Ue}=G(Ot,()=>({variables:{_id:a.selectedRequirement._id}}));_e(e=>{console.log(e,"ERR Requirements")}),Ue(()=>{a.confirmDeleteRequirement=!1,h.notify({color:"negative",message:"Requirement Deleted: "+a.selectedRequirement.Name,icon:"warning",position:"bottom",timeout:1e3})});const Be=re("formatDate");function Fe(){a.editMode=!0}function We(e){a.showRequirementModal=e}const K=d({}),{mutate:ze,onDone:He,onError:xe}=G(Ht,()=>({variables:K.value}));He(()=>{M()}),xe(e=>{console.log(e,"result ERROR")});function X(){ze(),a.editMode=!1}const H=d(!1);function fe(e){a.project_process_id=e._id,K.value={_id:i.params.id,project_process_id:e._id},X(),setTimeout(()=>{H.value=!0},200),setTimeout(()=>{H.value=!1},500)}function ge(e){a.skill_id=e._id,K.value={_id:i.params.id,skill_id:e._id},X(),setTimeout(()=>{H.value=!0},200),setTimeout(()=>{H.value=!1},500)}const{mutate:Ye,onDone:Je,onError:Ke}=G(xt,()=>({variables:{_id:i.params.id,_ids:a.selectedRequirement._id}}));Ke(e=>{console.log(e,"requirement unassign ERROR")}),Je(e=>{console.log(e,"result DONE"),h.notify({color:"indigo",message:"Requirement Unassigned: "+a.selectedRequirement.Name,icon:"edit_note",position:"bottom",timeout:2e3}),M()});function Xe(e,s,g){a.selectedRequirement=e,s==="delete"?(a.relatedModel="Requirement",Ye()):(o(),g.ctrlKey||g.button===1||g==="openNewTab"?window.open(`implementation-type/requirement/${e}`,"_blank"):g==="openNewWindow"?window.open(`implementation-type/requirement/${e}`,"_blank","width=full,height=full"):g==="openIncognitoWindow"?window.open(`implementation-type/requirement/${e}`,"_blank","incognito=yes"):g.button!==2&&r.push({name:"ImplementationRequirementDetails",params:{id:e}}))}function Ze(e){a.showUpdateRequirementModal=e}function et(e,s){s!=="delete"?(K.value={_id:i.params.id,...e},X()):pe()}const tt=["Name","BlockHours","IsRecurring","SkillName","ProjectProcess","TaskType","SkillTier","isCustomerTask","IsDeprecated","IsDeprecatedReason"],A=x([{name:"name",align:"left",label:"Name",field:e=>e.Name,format:e=>`${e}`,sortable:!0},{name:"default",required:!0,label:"Include by Default",align:"center",field:e=>e.IncludeByDefault?"Yes":"No",format:e=>`${e}`,sortable:!0},{name:"status",label:"Status",align:"center",field:e=>e.IsDeprecated?"Deprecated":e.isDraft?"Draft":"Active"},{name:"attachment",label:"Actions",align:"right"}]),ot=()=>{if(l.value<=600){const e=A.findIndex(s=>s.name==="default");e!==-1&&A.splice(e,1)}else A.find(s=>s.name==="default")||A.splice(1,0,{name:"default",label:"Include by Default",field:s=>s.IncludeByDefault?"Yes":"No",sortable:!0});if(l.value<=500){const e=A.findIndex(s=>s.name==="status");e!==-1&&A.splice(e,1)}else A.find(s=>s.name==="status")||A.splice(1,0,{name:"status",label:"Status",field:s=>s.IsDeprecated?"Deprecated":s.isDraft?"Draft":"Active",sortable:!0})};oe(()=>l.value,()=>{Qe(),ot()},{immediate:!0});function at(e){a.showGuidelineModal=e,c.setPage(1),c.setSearch("")}function he(e,s){e!=="close"&&s!=="search"&&(a.selectedGuidelineID=e._id,a.relatedName=e.Name)}const{mutate:ke,onDone:nt,onError:lt}=G(Yt,()=>({variables:{_id:i.params.id,action:a.guidelineActionType,relatedModel:"ImplementationGuideline",ids:a.selectedGuidelineID}}));lt(e=>{console.log(e,"result ERROR")});function st(){a.guidelineActionType="add",ke(),setTimeout(()=>{M()},500)}function it(e,s,g){a.selectedGuidelineID=e._id,a.relatedName=e.Name,s==="delete"?(a.guidelineActionType="remove",ke()):g.ctrlKey||g.button===1||g==="openNewTab"?window.open(`implementation-type/guideline/${e}`,"_blank"):g==="openNewWindow"?window.open(`implementation-type/guideline/${e}`,"_blank","width=full,height=full"):g==="openIncognitoWindow"?window.open(`implementation-type/guideline/${e}`,"_blank","incognito=yes"):g.button!==2&&r.push({name:"GuidelineDetails",params:{id:e}})}nt(e=>{console.log(e,"result DONE"),h.notify({color:"indigo",message:"Implementation Guideline "+(a.guidelineActionType==="add"?"Attached: ":"Unassigned: ")+a.relatedName,icon:"edit_note",position:"bottom",timeout:2e3}),M()});const U=d([]),{result:Z,loading:rt}=B(Jt,()=>({Name:R.search,page:R.page,first:15})),ee=d(!1),we=d("");F(()=>{if(rt.value&&(ee.value=!0),R.search!==we.value&&(ee.value=!0,U.value=[],we.value=R.search),Z.value){ee.value=!1;const e=U.value;Z.value&&Z.value.Skills&&(U.value=[...U.value,...Z.value.Skills.data],R.setSpinner(U.value,e))}});function dt(e){e==="Skill Name"?R.onSetValueCallback(ge):e==="Project Process"&&E.onSetValueCallback(fe)}const ve=d([]),{result:ye,loading:ut}=B(eo,()=>({first:40})),se=d(!1);F(()=>{ut.value&&(se.value=!0),ye.value&&(se.value=!1,ve.value=ye.value.ProjectProcesses.data)});const O=d([]),te=d(!1),{result:Re,loading:mt}=B(to,()=>({page:c.page,Name:c.search,first:10})),Ce=d("");F(()=>{if(mt.value&&(te.value=!0),c.search!==Ce.value&&(te.value=!0,O.value=[],Ce.value=c.search),Re.value){te.value=!1;let e=O.value;const s=Re.value.ImplementationGuidelines.data.filter(g=>!O.value.some(be=>be._id===g._id));c.page>1?O.value=[...O.value,...s]:O.value=[...O.value,...s],c.setSpinner(O.value,e)}}),c.onSetValueCallback(he);const ct=W(()=>C.value);function pt(e){C.value=[...C.value,{...e}]}const ft=re("contextMenuSetter");function gt(e,s,g){console.log("handleRequirementClick",e,s,g),e==="delete"?vt(s):ft({id:s.requirement_id,evt:g,route:"implementation-type/requirement",routeName:"ImplementationRequirementDetails",loadingMessage:"Redirecting to Requirement..."})}const ie=d(""),{mutate:ht,onDone:kt,onError:wt}=G(Vt,()=>({variables:{_id:ie.value}}));wt(e=>{console.log(e,"result ERROR")}),kt(e=>{console.log(e,"onDoneRequirementDELETE"),h.notify({message:"Requirement Deleted",timeout:1e3,color:"red-8",icon:"delete",actions:[{label:"Reload",color:"white",handler:()=>window.location.reload()}]}),C.value=C.value.filter(s=>s._id!==e._id)});function vt(e){ie.value=e._id,console.log("Deleting item: ",e,ie.value),ht()}const yt=d(""),V=d(null);function Rt(e,s){yt.value=e._id,V.value=s,C.value.length*10<=s?V.value=V.value+5:V.value=V.value-5,console.log("updateRequirementOrder",e,V.value,"req length",C.value.length*10);let g={_id:e._id,order:V.value};Ct(g),console.log("Updating order for item: ",e.Name," at index: ",V.value)}const{mutate:Ct,onDone:bt}=G(jt);bt(e=>{console.log(e,"onDoneRequirementOrder ON DONE"),h.notify({message:"Requirement Order Updated",timeout:1e3,color:"indigo-9",icon:"done"})});let Tt=d([{type:"all",label:"Show All",icon:"sort"},{type:"requirements",label:"Requirements",icon:"info"},{type:"guidelines",label:"Implementation Guidelines",icon:"history"}]);function qt(e){return{cursor:"cursor-pointer",textColor:"white",tooltip:null,icon:e.icon}}function Dt(e){a.showComponentType=e}function Mt(e){return e===a.showComponentType?"blue-6":"primary"}return{state:a,route:i,skills:U,setShowSkillModal:D,setPage:n,updateTask:X,errorTask:f,implementationTask:k,setShowTaskModal:T,columns:z,refetchTasks:M,editingTask:y,formatDate:Be,setEditTask:Fe,setRequirementModal:We,setProjectProcessId:fe,setSkillId:ge,deleteTask:pe,requirements:C,setRequirementEditMode:Xe,setShowUpdateRequirementModal:Ze,deleteRequirement:Le,editableFields:tt,updateTaskData:et,cancelEditing:H,implementationGuidelineTasks:q,introspectionValue:le,relatedGuidelines:m,guidelineColumns:A,setShowGuidelineModal:at,setGuidelineId:he,saveAttachedComponent:st,setGuidelineEditMode:it,setWhichFieldEditing:dt,projectProcesses:ve,projProcessIsLoading:se,implementationGuidelines:O,isGuidelineLoading:te,isLoading:ee,isLoadingTask:Y,searchOptionsGuideline:c,searchOptionsSkill:R,searchOptionsProjectProcess:E,darkmode:v,computeSortedRequirements:ct,attachRequirementToTask:pt,handleRequirementClick:gt,updateRequirementOrder:Rt,sowToggleOptions:Tt,sowToggle:qt,setSection:Dt,activeColor:Mt}}}),Mo={class:"flex justify-center mx-3 sm:mx-12",style:{width:"100%"}},Io={style:{width:"100%"}},So={class:"mb-8 text-center text-2xl dark:text-slate-300"},No={style:{"list-style":"disc"},class:"ml-4"},Go={key:2,class:"flex justify-end mt-5 -mb-5"},Eo={key:4,class:"flex justify-end my-10 dark:border-slate-500"},Ao={key:5,class:"flex justify-end mt-5 -mb-5"};function Oo(t,o,v,i,r,a){const h=j("CreateRequirementModal"),l=j("SearchModel"),y=j("BasicAttachModal"),T=j("QCardDetails"),L=j("MarkupQTable"),D=j("ListQTable");return w(),P("div",Mo,[u("div",Io,[u("p",So,$(t.implementationTask.Name),1),t.state.showRequirementModal?(w(),N(h,{key:0,cardAddMode:"Exclusion",showComponentModal:t.state.showRequirementModal,setComponentModal:t.setRequirementModal,taskName:t.implementationTask.Name,pushNewResponseData:t.attachRequirementToTask},null,8,["showComponentModal","setComponentModal","taskName","pushNewResponseData"])):S("",!0),t.state.showGuidelineModal?(w(),N(y,{key:1,cardAddMode:"ImplementationGuidelines",showComponentModal:t.state.showGuidelineModal,setComponentModal:t.setShowGuidelineModal,createOnly:!0,title:"Implementation Guideline",selectedComponentID:t.state.selectedGuidelineID,saveComponent:t.saveAttachedComponent,createNewHref:"implementation-guideline/create"},{default:b(()=>[p(l,{class:"my-5 mx-8",label:"Implementation Guidelines",rows:t.implementationGuidelines,loading:t.isGuidelineLoading,filled:"","no-focus":"",store:t.searchOptionsGuideline,dark:t.darkmode},null,8,["rows","loading","store","dark"])]),_:1},8,["showComponentModal","setComponentModal","selectedComponentID","saveComponent"])):S("",!0),p(T,{response:t.implementationTask,editableFields:t.editableFields,updateResponse:t.updateTaskData,cancelEditing:t.cancelEditing,introspectionValue:t.introspectionValue,setWhichFieldEditing:t.setWhichFieldEditing,isLoading:t.isLoadingTask,type:"ImplementationTask"},{slot1:b(()=>[p(l,{filled:"",dense:"",rows:t.skills,value:"name",label:"Skills",loading:t.isLoading,defaultValue:t.implementationTask.SkillName,store:t.searchOptionsSkill,dark:t.darkmode},null,8,["rows","loading","defaultValue","store","dark"])]),slot2:b(()=>[p(l,{filled:"",dense:"",rows:t.projectProcesses,label:"Project Processes",loading:t.projProcessIsLoading,defaultValue:t.implementationTask.ProjectProcessName,store:t.searchOptionsProjectProcess,dark:t.darkmode},null,8,["rows","loading","defaultValue","store","dark"])]),_:1},8,["response","editableFields","updateResponse","cancelEditing","introspectionValue","setWhichFieldEditing","isLoading"]),o[4]||(o[4]=u("hr",{class:"flex justify-end my-10 dark:border-slate-500"},null,-1)),p(It,{rounded:"",class:"px-0 mt-0 mb-2 mx-10 md:mx-0 w-96 h-10"},{default:b(()=>[(w(!0),P(Te,null,qe(t.sowToggleOptions,(n,R)=>(w(),N(Q,{key:R,color:t.activeColor(n.type),dark:t.darkmode,label:n.label,class:Ie([t.sowToggle(n).cursor,"w-full text-no-wrap"]),style:{"font-weight":"600","letter-spacing":"0.4px"},"no-caps":"","text-color":t.sowToggle(n).textColor,onClick:c=>t.setSection(n.type)},{default:b(()=>[t.sowToggle(n).tooltip?.length>0&&n.type!=="all"?(w(),N(Ge,{key:0,style:{"font-size":"0.9rem","min-width":"10rem","max-width":"20rem"},class:"bg-white text-slate-700 border shadow-md"},{default:b(()=>[u("ul",No,[(w(!0),P(Te,null,qe(t.sowToggle(n).tooltip,(c,E)=>(w(),P("li",{key:E},$(c.name??c.Name),1))),128))])]),_:2},1024)):S("",!0)]),_:2},1032,["color","dark","label","class","text-color","onClick"]))),128))]),_:1}),t.state.showComponentType==="all"||t.state.showComponentType==="requirements"?(w(),P("div",Go,[p(ne,{modelValue:t.state.search,"onUpdate:modelValue":o[0]||(o[0]=n=>t.state.search=n),filled:"",dense:"",placeholder:"Search Requirements",class:"w-1/3 absolute left-3 sm:left-12",style:{"margin-right":"1rem"},dark:t.darkmode},{append:b(()=>[p(ae,{name:"search"})]),_:1},8,["modelValue","dark"]),p(Q,{color:"primary","no-caps":"",icon:"add",label:"Attach Requirement",onClick:o[1]||(o[1]=n=>t.setRequirementModal(!0))})])):S("",!0),t.state.showComponentType==="all"||t.state.showComponentType==="requirements"?(w(),N(L,{key:3,title:"Related Task Requirements ("+t.requirements.filter(n=>n.Requirement).length+")",class:"mt-7",rows:t.computeSortedRequirements,handleRowClick:t.handleRequirementClick,updateComponentOrder:t.updateRequirementOrder,idValue:"requirement_id",headerTooltip:"Requirements will appear in this order when printing a SOW Document"},null,8,["title","rows","handleRowClick","updateComponentOrder"])):S("",!0),t.state.showComponentType==="all"?(w(),P("hr",Eo)):S("",!0),t.state.showComponentType==="all"||t.state.showComponentType==="guidelines"?(w(),P("div",Ao,[p(ne,{modelValue:t.state.searchGuideline,"onUpdate:modelValue":o[2]||(o[2]=n=>t.state.searchGuideline=n),filled:"",dense:"",placeholder:"Search Implementation Guidelines",class:"w-1/3 absolute left-3 sm:left-12",style:{"margin-right":"1rem"},dark:t.darkmode},{append:b(()=>[p(ae,{name:"search"})]),_:1},8,["modelValue","dark"]),p(Q,{color:"primary","no-caps":"",icon:"add",label:"Attach Implementation Guideline",onClick:o[3]||(o[3]=n=>t.setShowGuidelineModal(!0))})])):S("",!0),t.state.showComponentType==="all"||t.state.showComponentType==="guidelines"?(w(),N(D,{key:6,title:"Related Implementation Guidelines",rows:t.relatedGuidelines.filter(n=>n.Name&&n.Name.toLowerCase().includes(t.state.searchGuideline.toLowerCase())),columns:t.guidelineColumns,stateValue:t.state,setPage:t.setPage,loading:t.state.searchLoading,handleRowClick:t.setGuidelineEditMode,showPagination:!1},null,8,["rows","columns","stateValue","setPage","loading","handleRowClick"])):S("",!0)])])}const Ra=de(Do,[["render",Oo]]);export{Ra as default};
