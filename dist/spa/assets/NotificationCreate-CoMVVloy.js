import{Q as O}from"./QCardSection-C1H36PMc.js";import{a6 as oe,a7 as se,al as ie,a8 as f,a9 as c,aa as l,ac as s,af as i,ab as L,Q as R,ap as le,a4 as ne,am as $,aq as re,ar as ue,ai as q,ad as S,ah as w,ag as b,aA as de,as as me,ao as ce,ae as pe,aj as fe,E as V,o as ye,au as ve,aB as M,ax as Q,T as y,U as Ne,a3 as P,ay as ge,ak as Se}from"./index-DlQ8tVOz.js";import{Q as F,u as Ie}from"./dark-mode-C5mcaMLC.js";import{a as he,b as Ce,S as ke}from"./SearchModel-CL6OvBrG.js";import{Q as we}from"./ClosePopup-WKUFvClg.js";import{Q as be}from"./QItemLabel-CWFH1t2i.js";import{Q as m}from"./QToggle-Uap1FPWi.js";import{Q as Ve}from"./QSelect-B9DBrxqc.js";import{Q as Me}from"./QCard-Cs9621IB.js";import{u as Qe}from"./use-quasar-BZIho4RN.js";import{C as Te}from"./AccountNotification-B3GMaR3t.js";import{a as De}from"./Account-DIwqJEDQ.js";import{C as Ee}from"./Contact-7RcK0SBF.js";import{e as Ae}from"./searchStore-C_zORX-X.js";import{S as Ue}from"./SiemNotification-BbB9vkUG.js";import"./use-key-composition-4VZXaA1o.js";import"./index-wVk5-s-q.js";import"./parser-yifRV-tr.js";import"./QResizeObserver-BZ8Br9AP.js";import"./QScrollObserver-CnNw1O5L.js";import"./touch-BjYP5sR0.js";import"./search-BNxH718U.js";import"./QChip-Cw-nA85J.js";import"./QDialog-1bsBaQz_.js";const Be=se({components:{SearchModel:ke},props:{cardAddMode:{type:String,default:""},showComponentModal:{type:Boolean,default:!1},setComponentModal:{type:Function,default:()=>{}},pushNewResponseData:{type:Function,default:()=>{}},refetch:{type:Function,default:()=>{}},accountID:{type:Number,default:null},showNotificationTypes:{type:Boolean,default:!1}},setup(t){const a=fe(),T=V(()=>parseInt(a.params.id)),D=V(()=>Ie().darkmode);let I="",v="";const N=Qe();try{I=ye.getItem("userData"),v=JSON.parse(I)}catch(o){console.log(o)}const e=ve({name:"",componentId:null,firstName:"",lastName:"",isAlrImp:!1,showModal:!1,whichOne:"false",resetName:!1,associatedImple:null,associatedImpleName:"",newRequirementName:"",newRequirementId:null,newDiscoveryQuestion:"",newResponseType:"Document Upload",isCreateNew:!1,componentName:"",componentDetail:"",newName:"",componentSearch:"",isMenuOpen:!1,page:1,showSpinner:!1,email:!0,sms:!1,high:!1,medium:!0,low:!1,critical:!1,info:!1,severityArray:[],isSIEM:!1,notificationTypes:[],notificationTypeID:null,description:"",siemNotification:"",notificationInputType:"text"}),{result:d,error:h}=M(De,()=>({autotask_id:t.accountID?t.accountID:v.account_id}));Q(()=>{d.value&&d.value.Company&&d.value.Company.AvailableNotifications!==null&&(e.notificationTypes=d.value.Company.AvailableNotifications,e.isSIEM=!0),h.value&&console.log(h.value,"accountError")});const p=y([]),z=V(()=>e.componentId?!1:!e.isCreateNew);let E;const j=(o,n)=>{clearTimeout(E),E=setTimeout(o,n)};Ne(()=>e.componentSearch,()=>{const[o,n]=e.componentSearch.split(" ");e.firstName=o,e.lastName=n,j(async()=>{e.page=1,p.value=[]},500)}),P(()=>{e.showModal=!0,A()});async function A(){await H()}const H=async()=>{const{result:o,error:n}=M(Ee,()=>({firstName:e.firstName,lastName:e.lastName,page:e.page,first:20}));Q(()=>{if(n.value&&console.log(n.value,"error"),o.value){const k=p.value;o.value&&(p.value=[...p.value,...o.value.Contacts.data]),k===p.value?setTimeout(()=>{e.showSpinner=!1},200):e.showSpinner=!0}})};function U(){N.loading.show({message:"Generating Account Notification and Redirecting...",spinnerSize:100,spinnerColor:"primary",messageColor:"white",backgroundColor:"primary"}),setTimeout(()=>{N.loading.hide()},2e3)}const{mutate:G,onDone:J}=ge(Te,()=>({variables:{account_id:t.accountID?t.accountID:v.account_id,contact_id:e.componentId,send_email:e.email,send_sms:e.sms,severity:e.severityArray,description:e.description,siem_notification_id:e.notificationTypeID}})),K=Se();J(o=>{t.refetch(),K.push({name:"NotificationDetails",params:{id:o.data.CreateAccountNotificationMutation._id}})});function W(o){e.critical&&e.severityArray.push(0),e.high&&e.severityArray.push(1),e.medium&&e.severityArray.push(2),e.low&&e.severityArray.push(3),e.info&&e.severityArray.push(4),G(),o==="another"?(U(),e.componentId=null,e.componentSearch="",document.body.style.cursor="wait"):setTimeout(()=>{e.showModal=!1,U(),document.body.style.cursor="wait"},1e3),setTimeout(()=>{document.body.style.cursor="default"},1001)}function X(){e.isCreateNew=!0,e.isMenuOpen=!1}function Y(){e.isMenuOpen=!0}function Z(o){e.componentId=o.id,console.log(o,"item"),e.name=o.eMailAddress,e.componentSearch=o.firstName+" "+o.lastName,e.isMenuOpen=!1,e.isCreateNew=!1}const x=async(o,n)=>{o===e.page&&(e.page++,setTimeout(()=>{n()},500))},_=y([{label:"SIEM",value:1}]),r=Ae(),{result:C,loading:ee}=M(Ue,()=>({title:r.search,first:15,page:r.page})),g=y(!1),B=y(""),u=y([]);Q(()=>{if(ee.value&&(g.value=!0),B.value!==r.search&&(console.log(r,"searchOptionsBase.search"),g.value=!0,u.value=[],B.value=r.search),C.value){console.log(C.value.SiemNotifications.data,"siemNotificationsData"),g.value=!1;const o=u.value,n=C.value.SiemNotifications.data.filter(k=>!u.value.some(ae=>ae.title===k.title));r.page>1?u.value=[...u.value,...n]:u.value=[...n,...u.value],r.setSpinner(u.value,o)}});function te(o){e.notificationTypeID=o.id,console.log(e.notificationTypeID,"setSIEMNotifcationID")}return P(()=>{r.onSetValueCallback(te)}),{loadQuery:x,state:e,createSowComponent:W,setCreateNew:X,disableCreate:z,handleInputClick:Y,accountNotifications:p,setComponentValue:Z,fetchComponent:A,sow_id:T,options:_,darkmode:D,siemNotifications:u,isLoading:g,searchOptionsBase:r}}}),Oe={style:{width:"100%"}},Le={class:"grid grid-cols-2 mt-1"},Re={key:0,class:"row justify-center q-my-md"},$e={class:"input-form intro-y mt-5 ml-3"},qe={class:"grid grid-cols-2"},Pe={class:"flex mb-2"},Fe={class:"grid grid-cols-2"},ze={class:"flex mt-2"},je={class:"flex flex-col"},He={class:"flex flex-col ml-10"},Ge={style:{position:"absolute",right:"0px",bottom:"1rem"}};function Je(t,a,T,D,I,v){const N=ie("SearchModel");return c(),f(Me,{class:pe(["container intro-y box mx-10 w-[90%]",t.darkmode?"bg-[#28334E] text-slate-400":""])},{default:l(()=>[s(O,{class:"col flex flex-col mb-0 pb-0"},{default:l(()=>[...a[16]||(a[16]=[i("p",{class:"text-xl mt-4 text-center text-slate-600 dark:text-slate-300"}," Create an Account Notification ",-1),i("hr",{style:{width:"100%"},class:"dark:border-slate-500 mt-3"},null,-1)])]),_:1}),s(O,{class:"items-center"},{default:l(()=>[i("div",null,[i("div",Oe,[i("div",Le,[i("div",null,[s(F,{ref:"componentSearchRef",modelValue:t.state.componentSearch,"onUpdate:modelValue":a[1]||(a[1]=e=>t.state.componentSearch=e),class:"component-search mx-3",filled:"",label:"Select Contact *",dense:"",dark:t.darkmode,onClick:t.handleInputClick},{append:l(()=>[s(R,{name:t.state.componentSearch===""?"search":"close",class:"cursor-pointer clear-search",onClick:a[0]||(a[0]=()=>{t.state.componentSearch="",t.state.componentId=null})},null,8,["name"])]),_:1},8,["modelValue","dark","onClick"]),s(le,{"model-value":t.state.menuOpen,"no-focus":""},{default:l(()=>[ne(s(we,{class:"scroll infinate-list"},{default:l(()=>[s(he,{offset:100,onLoad:t.loadQuery},{default:l(()=>[(c(!0),$(re,null,ue(t.accountNotifications,(e,d)=>(c(),f(q,{key:d,clickable:"",onClick:h=>t.setComponentValue(e)},{default:l(()=>[e.firstName!=="unknown"&&e.lastName!=="unknown"?(c(),f(S,{key:0},{default:l(()=>[w(b(e.firstName)+" "+b(e.lastName),1)]),_:2},1024)):(c(),f(S,{key:1},{default:l(()=>[w(b(e.eMailAddress),1)]),_:2},1024))]),_:2},1032,["onClick"]))),128)),t.state.showSpinner?(c(),$("div",Re,[s(Ce,{color:"primary",size:"40px"})])):L("",!0)]),_:1},8,["onLoad"])]),_:1},512),[[de,t.state.isMenuOpen]])]),_:1},8,["model-value"])]),s(N,{label:"SIEM Notifications *",rows:t.siemNotifications,loading:t.isLoading,darkmode:t.darkmode,value:"title",dense:"",filled:"",class:"mx-3","no-focus":"",store:t.searchOptionsBase},null,8,["rows","loading","darkmode","store"])]),s(F,{modelValue:t.state.description,"onUpdate:modelValue":a[3]||(a[3]=e=>t.state.description=e),class:"component-search mt-5 mx-3",filled:"",label:"Description / Notes",dense:"",dark:t.darkmode,type:t.state.notificationInputType},{append:l(()=>[s(R,{name:t.state.notificationInputType==="text"?"add_box":"indeterminate_check_box",class:"cursor-pointer clear-search",onClick:a[2]||(a[2]=()=>{t.state.notificationInputType==="text"?t.state.notificationInputType="textarea":t.state.notificationInputType="text"})},null,8,["name"])]),_:1},8,["modelValue","dark","type"]),t.showNotificationTypes?(c(),f(Ve,{key:0,modelValue:t.state.notificationTypes,"onUpdate:modelValue":a[7]||(a[7]=e=>t.state.notificationTypes=e),options:t.options,label:"Notification Type",filled:"",multiple:"","emit-value":"",dense:"","map-options":"",class:"mx-3 mt-4",dark:t.darkmode},{option:l(({itemProps:e})=>[s(q,me(e,{onClick:a[6]||(a[6]=()=>{t.state.isSIEM=!t.state.isSIEM,t.state.isSIEM||(t.state.notificationTypes=[])})}),{default:l(()=>[s(S,null,{default:l(()=>[s(be,null,{default:l(()=>[...a[17]||(a[17]=[w("SIEM",-1)])]),_:1})]),_:1}),s(S,{side:""},{default:l(()=>[s(m,{modelValue:t.state.isSIEM,"onUpdate:modelValue":a[4]||(a[4]=d=>t.state.isSIEM=d),onClick:a[5]||(a[5]=()=>{t.state.isSIEM=!t.state.isSIEM,t.state.isSIEM||(t.state.notificationTypes=[])})},null,8,["modelValue"])]),_:1})]),_:1},16)]),_:1},8,["modelValue","options","dark"])):L("",!0),i("div",$e,[a[20]||(a[20]=i("hr",{class:"my-3 dark:border-slate-500 mr-3"},null,-1)),i("div",qe,[a[18]||(a[18]=i("div",null,[i("p",{class:"text-lg text-slate-600 dark:text-slate-300"}," Contact Preferences "),i("p",{class:""},"How should the user be Notified?")],-1)),i("div",Pe,[s(m,{modelValue:t.state.email,"onUpdate:modelValue":a[8]||(a[8]=e=>t.state.email=e),label:"Email",class:"mr-10"},null,8,["modelValue"]),s(m,{modelValue:t.state.sms,"onUpdate:modelValue":a[9]||(a[9]=e=>t.state.sms=e),label:"SMS"},null,8,["modelValue"])])]),a[21]||(a[21]=i("hr",{class:"dark:border-slate-500 mr-3 my-3"},null,-1)),i("div",Fe,[a[19]||(a[19]=i("div",null,[i("p",{class:"text-lg text-slate-600 dark:text-slate-300"}," Notification Priority "),i("p",null,"Set the Priority of Notifications for this User")],-1)),i("div",ze,[i("div",je,[s(m,{modelValue:t.state.high,"onUpdate:modelValue":a[10]||(a[10]=e=>t.state.high=e),label:"High"},null,8,["modelValue"]),s(m,{modelValue:t.state.medium,"onUpdate:modelValue":a[11]||(a[11]=e=>t.state.medium=e),label:"Medium"},null,8,["modelValue"]),s(m,{modelValue:t.state.low,"onUpdate:modelValue":a[12]||(a[12]=e=>t.state.low=e),label:"Low"},null,8,["modelValue"])]),i("div",He,[s(m,{modelValue:t.state.critical,"onUpdate:modelValue":a[13]||(a[13]=e=>t.state.critical=e),label:"Critical"},null,8,["modelValue"]),s(m,{modelValue:t.state.info,"onUpdate:modelValue":a[14]||(a[14]=e=>t.state.info=e),label:"Information"},null,8,["modelValue"])])])])])]),a[22]||(a[22]=i("div",{class:"mt-14"},null,-1)),i("div",Ge,[s(ce,{dense:"",disable:t.state.componentId===null,class:"save-btn q-px-md",style:{"margin-right":"1.5rem","margin-left":"0rem"},"no-caps":"",label:"Create Account Notification",color:"primary",onClick:a[15]||(a[15]=e=>t.createSowComponent("close"))},null,8,["disable"])])])]),_:1})]),_:1},8,["class"])}const Nt=oe(Be,[["render",Je],["__scopeId","data-v-70ce8c2a"]]);export{Nt as default};
