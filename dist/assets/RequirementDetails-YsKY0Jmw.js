import{a6 as be,a7 as De,al as T,am as Te,ab as w,a9 as I,af as y,a8 as A,ac as k,ao as G,ag as we,aa as X,Q as Ie,E as Y,aj as ye,au as Q,ak as Ce,aB as C,T as l,ax as M,O as Me,U as Se,ay as S}from"./index-CQCl7-n1.js";import{Q as Ne,u as Pe}from"./dark-mode-D-GqxvW3.js";import{L as Ae}from"./ListQTable-DoGh3vFW.js";import{u as Qe}from"./use-quasar-CeTCeS0j.js";import{B as $e}from"./BasicAttachModal-Vgo0mwAq.js";import{Q as Ve}from"./QCardDetails-6q-DwPz1.js";import{S as Be}from"./SearchModel-hS4W0wni.js";import{u as Le,s as je}from"./pinia-Cu7h5Kzx.js";import{R as Ee}from"./Requirement-DtbUlzwp.js";import{a as _e}from"./AdminRequirement-Bm1tkYi6.js";import{I as He}from"./Introspection-FbDfCq5f.js";import{U as Ue,D as Oe,R as Fe,M as We}from"./Requirement-CzymwlqD.js";import{I as ze}from"./ImplementationTask-D6cNH7wg.js";import{s as d}from"./search-DNJIg9HY.js";import"./use-key-composition-B6EajJfj.js";import"./index-BAc7fDxH.js";import"./parser-C_oP7G4F.js";import"./QSelect-CZoYKFij.js";import"./QChip-tlUzG03O.js";import"./QItemLabel-4PS5Ii4A.js";import"./QDialog-0UbYXYZ9.js";import"./QToggle-X9yPZq_d.js";import"./QMarkupTable-DiNkxTl4.js";import"./ClosePopup-TnQGvSW-.js";import"./QPagination-OEL0QgjP.js";import"./QCard-D9NvINpq.js";import"./QSkeleton-B7rOYwnS.js";import"./QSeparator-DqL40xTU.js";import"./QCardSection-CUOYl02q.js";import"./QCardActions-BYtFZJPE.js";import"./QFile-BzE_8x3B.js";import"./QResizeObserver-CpFCL3bZ.js";import"./QScrollObserver-D1yOb7nN.js";import"./touch-BjYP5sR0.js";const Je=De({components:{ListQTable:Ae,BasicAttachModal:$e,QCardDetails:Ve,SearchModel:Be},setup(){const t=Le(je),r=Y(()=>t.sowID),$=Y(()=>Pe().darkmode),i=ye(),o=Q({editMode:!1,name:"",blockHours:"",skillId:"",projectProcessId:"",taskType:"",isRecurring:!1,isCustomerTask:!1,confirmDelete:!1,selectedRequirement:{},description:"",page:1,totalPages:0,deleteRoot:!1,search:"",showModal:!1,selectedTaskID:null,actionType:"add"}),p=Ce(),{result:c,error:h,refetch:v}=C(Ee,()=>({page:o.page,first:11})),R=l([]);M(()=>{h.value&&console.log(h.value,"errReq"),c.value&&(R.value=c.value.Requirements.data,o.totalPages=c.value.Requirements.paginatorInfo.lastPage)});const n=l({}),{result:q,error:V}=C(_e,()=>({_id:i.params.id})),B=l(!0),f=l([]);M(()=>{q.value&&(B.value=!1,console.log(q.value,"requirementSingleData"),n.value={...q.value.AdminRequirement,ID:q.value.AdminRequirement._id},o.name=n.value.Name,o.description=n.value.Description,f.value=n.value.AdminImplementationTasks&&n.value.AdminImplementationTasks.map(e=>({...e,ProjectProcessName:e&&e.ProjectProcess&&e.ProjectProcess.Name?e.ProjectProcess.Name:"N/A"}))),V.value&&console.log(V.value,"error")});const{result:L,error:j}=C(He,()=>({name:"Requirement"})),E=l([]);M(()=>{j.value&&console.log(JSON.stringify(j.value,null,2)),L.value&&L.value.__type.fields.map(e=>{e.description!==null&&E.value.push(e)})});const Z=Q([{name:"name",align:"left",label:"Requirements",field:e=>e.Name,format:e=>`${e}`,sortable:!0},{name:"description",label:"Description",align:"center",field:e=>e.Description,format:e=>`${e}`,sortable:!0},{name:"attachment",required:!0,label:"Actions:",align:"right"}]),s=Q([{name:"name",align:"left",label:"Name",field:e=>e.Name,format:e=>`${e}`,sortable:!0},{name:"process",required:!0,label:"Project Process",align:"left",field:e=>e.ProjectProcessName,format:e=>`${e}`,sortable:!0},{name:"skillName",required:!0,label:"Skill",align:"left",field:e=>e.SkillName?e.SkillName:"N/A",format:e=>`${e}`,sortable:!0},{name:"block",required:!0,label:"Block Hours",align:"left",field:e=>e.BlockHours?e.BlockHours+" hrs":"0 hrs",format:e=>`${e}`,sortable:!0},{name:"attachment",label:"Actions"}]),b=Me("windowWidth"),x=()=>{if(b.value<=850){const e=s.findIndex(a=>a.name==="block");e!==-1&&s.splice(e,1)}else s.find(a=>a.name==="block")||s.splice(3,0,{name:"block",required:!0,label:"Block Hours",align:"left",field:a=>a.BlockHours?a.BlockHours+" hrs":"0 hrs",format:a=>`${a}`,sortable:!0});if(b.value<=780){const e=s.findIndex(a=>a.name==="skillName");e!==-1&&s.splice(e,1)}else s.find(a=>a.name==="skillName")||s.splice(2,0,{name:"skillName",required:!0,label:"Skill",align:"center",field:a=>a.SkillName?a.SkillName:"N/A",format:a=>`${a}`,sortable:!0});if(b.value<=530){const e=s.findIndex(a=>a.name==="process");e!==-1&&s.splice(e,1)}else s.find(a=>a.name==="process")||s.splice(1,0,{name:"process",required:!0,label:"Project Process",align:"left",field:a=>a.ProjectProcessName,format:a=>`${a}`,sortable:!0})};Se(()=>b.value,()=>{x()},{immediate:!0});function ee(e,a,u){a==="delete"?(o.selectedTaskID=e._id,o.actionType="remove",z()):u.ctrlKey||u.button===1||u==="openNewTab"?window.open(`implementation-type/task/${e}`,"_blank"):u==="openNewWindow"?window.open(`implementation-type/task/${e}`,"_blank","width=full,height=full"):u==="openIncognitoWindow"?window.open(`implementation-type/task/${e}`,"_blank","incognito=yes"):u.button!==2&&p.push({name:"ImplementationTaskDetails",params:{id:e}})}function ae(e,a){o.selectedRequirement=e,a==="delete"?o.confirmDelete=!0:p.push({name:"ImplementationRequirementDetails",params:{id:e}})}function te(e){o.page=e}const _=l(null),H=l(null);function oe(e){o.editMode=e,setTimeout(()=>{e==="Name"?_.value.focus():e==="Description"&&H.value.focus()},300)}const U=l({}),{mutate:O,onDone:se,onError:ne}=S(Ue,()=>({variables:U.value}));se(()=>{v()}),ne(e=>{console.log(e,"error")});const{mutate:F,onDone:le}=S(Oe,()=>({variables:{_id:i.params.id}})),g=Qe();le(e=>{v(),g.notify({message:"Requirement Deleted: "+e.data.DeleteRequirementMutation.Name,color:"primary",icon:"delete",timeout:5e3,actions:[{label:"Undo",color:"white",handler:()=>ue(e.data.DeleteRequirementMutation._id)}]}),setTimeout(()=>{g.loading.show({delay:400,message:"Redirecting to Requirements...",spinnerSize:100,spinnerColor:"primary",messageColor:"white",backgroundColor:"primary"})},4e3),setTimeout(()=>{p.push({name:"Requirements"})},5e3),setTimeout(()=>{g.loading.hide()},6e3)});const N=l(null),{mutate:re,onDone:ie,onError:me}=S(Fe,()=>({variables:{_id:N.value}}));me(e=>{console.log(e,"error")}),ie(e=>{console.log("onDoneRestoreRequirement",e),g.notify({message:"Requirement Restored: "+e.data.RestoreRequirementMutation.Name,color:"green",icon:"redo",timeout:8e3})});function ue(e){N.value=e,re()}function de(e,a){console.log(e,a,":test"),O(),setTimeout(()=>{o.editMode=""},500)}function ce(e,a){a!=="delete"?(U.value={_id:i.params.id,...e},O()):(console.log(i.params.id,"route.params.id"),N.value=i.params.id,F())}function pe(e){o.showModal=e}const fe=["Name","Description"];function W(e,a){e!=="close"&&(a==="search"||(o.selectedTaskID=e._id))}const{mutate:z,onDone:ge,onError:ke}=S(We,()=>({variables:{_id:i.params.id,action:o.actionType,ids:o.selectedTaskID,relatedModel:"ImplementationTask"}}));ge(e=>{console.log("onDoneManageRelationshipsRequirement",e),g.notify({message:o.actionType==="remove"?"Implementation Task Removed":"Implementation Task Attached",color:o.actionType==="remove"?"primary":"green",icon:"check",timeout:4e3}),o.actionType==="remove"&&(f.value=f.value.filter(a=>a._id!==o.selectedTaskID)),o.actionType="add"}),ke(e=>{console.log(e,"error")});function he(){console.log("saveAttachedComponent",o.selectedTaskID,i.params.id),z(),setTimeout(()=>{d.setSearch("")},3e3)}function ve(){p.push({name:"SowDetails",params:{_id:r.value}})}const{result:P,loading:Re,error:J}=C(ze,()=>({Name:d.getState.search,page:d.getState.page,first:15})),m=l([]),D=l(!1),K=l("");return M(()=>{if(J.value&&console.log("errorTasks",J.value),Re.value&&(D.value=!0),d.getState.search!==K.value&&(D.value=!0,m.value=[],K.value=d.getState.search),P.value){console.log(P.value,"tasksData"),D.value=!1;let e=m.value;const a=P.value.ImplementationTasks.data.filter(u=>!f.value.some(qe=>qe._id===u._id));d.getState.page>1?m.value=[...m.value,...a]:m.value=[...a,...m.value],d.setSpinner(m.value,e)}}),d.onSetValueCallback(W),{state:o,requirements:R,columns:s,requirementColumns:Z,requirementValue:n,relatedTasks:f,goToTask:ee,requirementUpdate:ae,setPage:te,setEditMode:oe,nameInput:_,descriptionInput:H,updateFields:de,deleteRequirement:F,setShowModal:pe,editableFields:fe,updateRequirementData:ce,requirementData:c,introspectionValue:E,setTaskID:W,saveAttachedComponent:he,returnToSow:ve,routingSowID:r,tasks:m,isLoadingTasks:D,darkmode:$,loading:B}}}),Ke={key:0,style:{"border-radius":"5px"},class:"w-full mx-3 sm:mx-12"},Ge={class:"intro-y box w-full"},Xe={class:"mb-8 text-center text-2xl dark:text-slate-300"},Ye={class:"flex justify-end mt-5 -mb-5"};function Ze(t,r,$,i,o,p){const c=T("SearchModel"),h=T("BasicAttachModal"),v=T("QCardDetails"),R=T("ListQTable");return t.requirementData?(I(),Te("div",Ke,[y("div",Ge,[t.routingSowID!=="null"&&t.routingSowID!==null?(I(),A(G,{key:0,label:"Return to SOW","no-caps":"",icon:"arrow_back",color:"primary",class:"q-ma-md absolute left-4 sm:left-14 top-[-2.5rem] ml-0 shadow-sm shadow-blue-400",flat:"",onClick:t.returnToSow},null,8,["onClick"])):w("",!0),y("p",Xe,we(t.requirementValue.Name),1),t.state.showModal?(I(),A(h,{key:1,cardAddMode:"Exclusion",showComponentModal:t.state.showModal,setComponentModal:t.setShowModal,createOnly:!0,saveComponent:t.saveAttachedComponent,selectedComponentID:t.state.selectedTaskID,title:"Implementation Task",createNewHref:"implementation-task/create"},{default:X(()=>[k(c,{label:"Implementation Tasks",rows:t.tasks,loading:t.isLoadingTasks,filled:"","no-focus":"",class:"my-5 mx-4",dark:t.darkmode},null,8,["rows","loading","dark"])]),_:1},8,["showComponentModal","setComponentModal","saveComponent","selectedComponentID"])):w("",!0),t.requirementValue?(I(),A(v,{key:2,response:t.requirementValue,editableFields:t.editableFields,updateResponse:t.updateRequirementData,introspectionValue:t.introspectionValue,isLoading:t.loading,type:"Requirement"},null,8,["response","editableFields","updateResponse","introspectionValue","isLoading"])):w("",!0),r[2]||(r[2]=y("hr",{class:"w-full h-2 mt-10 mb-5 dark:border-slate-500"},null,-1)),y("div",Ye,[k(Ne,{modelValue:t.state.search,"onUpdate:modelValue":r[0]||(r[0]=n=>t.state.search=n),filled:"",dense:"",placeholder:"Search Related Tasks",class:"w-1/3 sm:w-52 absolute left-3 sm:left-12",style:{"margin-right":"1rem"},dark:t.darkmode},{append:X(()=>[k(Ie,{name:"search"})]),_:1},8,["modelValue","dark"]),k(G,{color:"primary","no-caps":"",icon:"add",label:"Attach Implementation Task",onClick:r[1]||(r[1]=n=>t.state.showModal=!0)})]),k(R,{title:"Related Implementation Tasks",rows:t.relatedTasks.filter(n=>n.Name&&n.Name.toLowerCase().includes(t.state.search.toLowerCase())),columns:t.columns,stateValue:t.state,loading:t.state.searchLoading,handleRowClick:t.goToTask,showPaginateOption:!1},null,8,["rows","columns","stateValue","loading","handleRowClick"])])])):w("",!0)}const Qa=be(Je,[["render",Ze]]);export{Qa as default};
