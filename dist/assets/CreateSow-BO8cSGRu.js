import{Q as G,u as ee}from"./dark-mode-Cd1QLq0S.js";import{Q as u}from"./QCardSection-Bxs731jM.js";import{a6 as ae,a7 as oe,al as R,am as se,a9 as te,ac as o,aa as r,af as d,ae as S,ao as le,au as re,E as ne,ak as ce,T as s,aB as H,ax as T,aC as ie,U as ue,ay as de}from"./index-D5yNAYFk.js";import{Q as fe}from"./QCard-CbW7iEIi.js";import{u as me}from"./use-quasar-DBA3fETA.js";import{a as we,M as pe,L as ve,h as he,f as Ce,C as ge}from"./CreateNewLocationModal-D-wlk4Qy.js";import{A as ke}from"./Account-D0LxHc_o.js";import{S as Se}from"./SearchModel-cNdkYKOA.js";import{l as be,d as Le,m as Me,n as ye,e as Te,o as Ae}from"./searchStore-DUG70Cdl.js";import"./use-key-composition-COT35ogy.js";import"./index-B22rUDyO.js";import"./parser-Dz45C1v8.js";import"./QDialog-B5BoQEQA.js";import"./QResizeObserver-BDylPG1O.js";import"./QScrollObserver-K0xo8zqm.js";import"./touch-BjYP5sR0.js";import"./ClosePopup-1nkdbb7J.js";import"./search-BG39UB0l.js";const Ne=oe({name:"CreateSow",components:{SearchModel:Se,CreateNewLocationModal:we},setup(){const e=re({sowNameValue:"",laborContract:"BlockHours",accountId:null,newSowId:0,overview:"Provider will provide resources for the duration of the project in which Engineers, Consultant, or Project Manager will assist with various IT tasks outlined this Project Scope. During this time, the Engineers, Consultant, or Project Manager will work closely with Customer staff.",reqAccount:!1,reqName:!1,cdw_am_id:null,accountValue:"",cdwValue:"john",cdwPage:1,locationID:null,milestone_id:null,salesperson_id:null,search:"",focusingSearchInput:null,isCreateNew:!1,select:""}),v=[{label:"Standard",value:"Standard"},{label:"Custom",value:"Custom"},{label:"Custom2",value:"Custom2"}],A=ee(),N=ne(()=>A.darkMode),n={name:function(a){a!=="close"&&(e.sowNameValue=a)},labor:function(a){a!=="close"&&(e.laborContract=a.value)},account:function(a){console.log(a,"account ID"),a!=="close"&&(e.accountId=a.autotask_id)},overview:function(a){a!=="close"&&(e.overview=a)},location:function(a){console.log(a,"location val"),a!=="close"&&(e.locationID=parseInt(a.autotask_id))},cdw_am_id:function(a){a!=="close"&&(e.cdw_am_id=a.id)},milestone_id:function(a){a!=="close"&&(e.milestone_id=a.id)},salesperson_id:function(a){a!=="close"&&(e.salesperson_id=a._id)}};async function _(){try{const{mutate:a}=de(he,()=>({variables:{account_id:e.accountId,Name:e.sowNameValue,LaborContractType:e.laborContract,Overview:e.overview,cdw_am_id:e.cdw_am_id,account_physical_location_id:e.locationID,MilestoneType:e.milestone_id,salesperson_id:e.salesperson_id}})),l=await a();t.loading.show({delay:400,message:"Generating SOW and Redirecting...",spinnerSize:100,spinnerColor:"primary",messageColor:"white",backgroundColor:"primary"});let C=l.data.CreateSowMutation.id;setTimeout(()=>{b(C)},1e3)}catch(a){console.error(a),t.loading.hide(),t.notify({message:"Error creating SOW: "+a,color:"negative",position:"bottom",icon:"report_problem",timeout:2e4})}}const f=ce();function b(a){t.loading.hide(),f.push({path:"/sow_details/"+a})}const t=me();function F(){_()}const m=be(),O=Le(),w=Me(),h=ye(),I=Te(),V=Ae(),J=s([]),{result:Q,loading:D}=H(ke,()=>({companyName:m.search,page:m.page,first:15})),c=s([]),L=s(!1),j=s("");T(()=>{if(D.value&&(L.value=!0),j.value!==m.search&&(L.value=!0,c.value=[],j.value=m.search),Q.value){L.value=!1;let a=c.value;const l=Q.value.Companies.data.filter(C=>!c.value.some(y=>y.autotask_id===C.autotask_id));m.page>1?c.value=[...c.value,...l]:c.value=[...l,...c.value],m.setSpinner(c.value,a)}});function K(a){console.log("Search input focused: ",a),e.focusingSearchInput=a,a==="Accounts"?m.onSetValueCallback(n.account):a==="Sales Person"?O.onSetValueCallback(n.salesperson_id):a==="CdwAMs"?w.onSetValueCallback(n.cdw_am_id):a==="Milestone"?V.onSetValueCallback(n.milestone_id):a==="Labor Type"?I.onSetValueCallback(n.labor):a==="Locations"&&h.onSetValueCallback(n.location)}const i=s([]),g=s(!1),{result:P,loading:X}=H(Ce,()=>({search:w.search,page:w.page,first:15})),B=s("");T(()=>{if(X.value&&(g.value=!0),B.value!==w.search&&(g.value=!0,i.value=[],B.value=w.search),P.value){g.value=!1;let a=i.value;const l=P.value.CdwAMs.data.filter(C=>!i.value.some(y=>y.id===C.id));w.page>1?i.value=[...i.value,...l]:i.value=[...l,...i.value],w.setSpinner(i.value,a)}});const p=s([]),k=s(!1),{result:M,loading:Y,error:E,load:q}=ie(ge,()=>({Address:e.search,companyID:e.accountId,first:50}));ue(()=>e.accountId,()=>{e.accountId!==null&&q()});const U=s(null),W=s(""),$=s(!0);T(()=>{if(E.value&&console.log(E.value),Y.value&&(k.value=!0),h.search&&W.value!==h.search&&(k.value=!0,W.value=h.search),M.value){k.value=!1;let a=p.value;p.value=M.value.CompanyLocations.data,console.log(p.value,M.value,"LOCATIONS"),p.value[0]&&$.value&&(U.value=z(p.value[0]),e.locationID=p.value[0].autotask_id),$.value=!1,h.setSpinner(p.value,a)}});function z(a){if(a==="Search Location")return"Search Location";{let l=a.address1+", "+a.city+" "+a.state+", "+a.postalCode;return a.address2!==""?a.address2+", "+l:l}}function Z(a){a!==void 0?e.isCreateNew=a:e.isCreateNew=!1}function x(a){a&&(e.search=a.address1+", "+a.city+" "+a.state+", "+a.postalCode,e.selectedID=a.autotask_id,n.location(a)),e.isMenuOpenTemplate=!1,setTimeout(()=>{e.isMenuOpenTemplate=!0},500)}return{state:e,createProject:F,setCreateSowObject:n,dense:!1,users:J,accounts:c,isAccountLoading:D,focusTracker:K,cdwAMs:i,isCdwAMLoading:g,LaborTypes:ve,Milestones:pe,locations:p,isLocationLoading:k,computedAddress:z,defaultLocation:U,setCreateNew:Z,setLocation:x,fetchLocations:q,searchOptionsLocation:h,searchOptionsBase:I,searchOptionsMilestone:V,searchOptionsAccount:m,searchOptionsUser:O,searchOptionsCdwAM:w,darkmode:N,options:v}},data:function(){return{}}}),_e={class:"w-full flex justify-center"},Oe={class:"col-12 mt-5 mb-[-1rem]"},Ie={class:"col-12"},Ve={class:"col-12"},Qe={class:"col-12"},De={class:"col-12"},je={class:"col-12"},Pe={class:"col-12"},Be={class:"col-12"};function Ee(e,v,A,N,n,_){const f=R("SearchModel"),b=R("CreateNewLocationModal");return te(),se("div",_e,[o(fe,{class:S(["w-full q-pa-md md:w-4/5",e.darkmode?"bg-[#28334E]":""])},{default:r(()=>[d("p",{class:S(["pt-7 ml-4 mr-5 text-xl border-b dark:border-slate-500",e.darkmode?"text-grey-5":"text-slate-500"])},"Create SOW",2),o(u,{class:"row items-center"},{default:r(()=>[d("div",Oe,[o(G,{modelValue:e.state.sowNameValue,"onUpdate:modelValue":v[0]||(v[0]=t=>e.state.sowNameValue=t),filled:"",outlined:"",label:"SOW Name",dense:e.dense,rules:[t=>!!t||"This field is required."],"data-cy":"sow-name",dark:e.darkmode,color:e.darkmode?"blue-5":"primary",class:S(e.darkmode?"bg-[#202a46] text-blue-5 pb-0 mb-3":"")},null,8,["modelValue","dense","rules","dark","color","class"])])]),_:1}),o(u,{class:"row items-center"},{default:r(()=>[d("div",Ie,[o(f,{label:"Accounts",value:"companyName",rows:e.accounts,class:"w-full",filled:"","no-focus":"",focusTracker:e.focusTracker,store:e.searchOptionsAccount},null,8,["rows","focusTracker","store"])])]),_:1}),o(u,{class:"row items-center"},{default:r(()=>[d("div",Ve,[o(f,{label:"Locations",rows:e.locations,loading:e.isLocationLoading,value:e.computedAddress,style:{width:"100%"},filled:"","no-focus":"",focusTracker:e.focusTracker,defaultValue:e.defaultLocation,disabled:e.state.accountId===null,isCreateNew:!0,setCreateNew:e.setCreateNew,store:e.searchOptionsLocation},null,8,["rows","loading","value","focusTracker","defaultValue","disabled","setCreateNew","store"])])]),_:1}),o(u,{class:"row items-center"},{default:r(()=>[d("div",Qe,[o(f,{label:"Sales Person",value:"name",rows:e.users,style:{width:"100%"},filled:"","no-focus":"",focusTracker:e.focusTracker,store:e.searchOptionsUser},null,8,["rows","focusTracker","store"])])]),_:1}),o(u,{class:"row items-center"},{default:r(()=>[d("div",De,[o(f,{label:"CdwAMs",value:"email",rows:e.cdwAMs,loading:e.isCdwAMLoading,style:{width:"100%"},filled:"","no-focus":"",focusTracker:e.focusTracker,store:e.searchOptionsCdwAM},null,8,["rows","loading","focusTracker","store"])])]),_:1}),o(u,{class:"row items-center"},{default:r(()=>[d("div",je,[o(f,{label:"Milestone",rows:e.Milestones,loading:!1,style:{width:"100%"},filled:"","no-focus":"",focusTracker:e.focusTracker,store:e.searchOptionsMilestone},null,8,["rows","focusTracker","store"])])]),_:1}),o(u,{class:"row items-center"},{default:r(()=>[d("div",Pe,[o(f,{label:"Labor Type",rows:e.LaborTypes,loading:!1,style:{width:"100%"},filled:"","no-focus":"",focusTracker:e.focusTracker,store:e.searchOptionsBase},null,8,["rows","focusTracker","store"])])]),_:1}),o(u,{class:"row items-center"},{default:r(()=>[d("div",Be,[o(G,{modelValue:e.state.overview,"onUpdate:modelValue":v[1]||(v[1]=t=>e.state.overview=t),filled:"",outlined:"",label:"Overview",dense:e.dense,type:"textarea",dark:e.darkmode,color:e.darkmode?"blue-5":"primary",class:S(e.darkmode?"bg-[#202a46] text-blue-5":"")},null,8,["modelValue","dense","dark","color","class"])])]),_:1}),o(u,{class:"text-right"},{default:r(()=>[o(le,{color:"primary",label:"Create SOW",class:"q-ma-md mr-0",dense:e.dense,"cy-data":"create-sow-button",onClick:e.createProject},null,8,["dense","onClick"])]),_:1})]),_:1},8,["class"]),o(b,{isCreateNew:e.state.isCreateNew,setAddMode:e.setCreateNew,setLocation:e.setLocation,accountId:e.state.accountId,refetchAccountLocations:e.fetchLocations},null,8,["isCreateNew","setAddMode","setLocation","accountId","refetchAccountLocations"])])}const sa=ae(Ne,[["render",Ee]]);export{sa as default};
