import{a6 as x,a7 as ee,al as R,am as Q,a9 as C,af as S,a8 as ae,ab as E,a4 as te,ac as m,ao as oe,aa as O,az as se,ah as ne,ae as F,aA as le,aq as re,T as d,aj as ie,ak as ce,E as ue,o as de,au as I,U as b,O as me,a3 as B,av as pe,aB as z,ax as U}from"./index-D5yNAYFk.js";import{Q as ge}from"./QToggle-DbLruOcG.js";import{Q as q,a as fe,S as he}from"./Sow-B5pOBE3v.js";import{S as we}from"./SearchModel-cNdkYKOA.js";import{L as Se}from"./ListQTable-DMWwlCDO.js";import{u as be}from"./use-quasar-DBA3fETA.js";import{s as i}from"./search-BG39UB0l.js";import{A as ve}from"./Account-D0LxHc_o.js";import{u as ye}from"./dark-mode-Cd1QLq0S.js";import"./use-key-composition-COT35ogy.js";import"./index-B22rUDyO.js";import"./parser-Dz45C1v8.js";import"./QResizeObserver-BDylPG1O.js";import"./QScrollObserver-K0xo8zqm.js";import"./touch-BjYP5sR0.js";import"./ClosePopup-1nkdbb7J.js";import"./QSelect-BmmHhKDO.js";import"./QChip-DHC18oyq.js";import"./QItemLabel-Cx7oXb7e.js";import"./QDialog-B5BoQEQA.js";import"./QMarkupTable-DvjuvEMf.js";import"./QPagination-CnwpqxMf.js";import"./QCard-CbW7iEIi.js";import"./QSkeleton-CQslW_MF.js";import"./QSeparator-NQtf9fTk.js";const Ce=ee({name:"SowOverview",components:{SearchModel:we,ListQTable:Se},setup(){const a=d([]),s=ie(),k=ce(),D=d({currentPage:1,perPage:15}),N=d([]),W=ye(),f=ue(()=>W.darkMode);let h="",l="";try{h=de.getItem("userData"),l=JSON.parse(h)}catch(e){console.log(e)}const t=I({page:1,perPage:15,total:0,search:"",totalPages:0,accountID:l.account_id===633&&s.path==="/sows"?null:l.account_id,searchLoading:!1,showMobileSearch:!1,showMobileSearchExiting:!1,hideFabLabels:!1,showRelatedSOWs:!1});b(()=>t.showRelatedSOWs,()=>{setTimeout(()=>{p()},1e3)}),b(()=>t.page,()=>{setTimeout(()=>{p()},1e3)});function j(e,o){o==="page"?t.page=e:o==="perPage"&&(t.perPage=e)}b(()=>t.perPage,()=>{setTimeout(()=>{p()},1e3)});const J=async(e,o)=>{console.log(e,o);const{result:r,error:w}=z(he,()=>({page:t.page,first:t.perPage,Name:t.accountID===null?i.getState.search:"",account_id:t.accountID,salesperson_id:t.showRelatedSOWs?l._id:null,orderBy:[{column:"ID",order:"DESC"}]})),V=d([]);U(()=>{w.value&&console.log(w.value),r.value&&(console.log(r.value.Sows.data,"SOWs",t.page,t.perPage,"Page",i.getState.search,t.accountID),V.value=r.value.Sows.data.map(n=>({...n,OpportunityStage:n.Opportunity&&n.Opportunity.StageName,OpportunityStatus:n.Opportunity&&n.Opportunity.StatusName,OpportunityTitle:n.Opportunity&&n.Opportunity.title,AccountName:n.Company&&n.Company.companyName,AccountOwnerName:n.Company&&n.Company.OwnerName,ParentAccountName:n.Company&&n.Company.ParentAccountName,ParentAccountId:n.Company&&n.Company.ParentAccountID,account_owner_id:n.Company&&n.Company.OwnerResourceID})),a.value=V.value,t.totalPages=r.value.Sows.paginatorInfo.lastPage)})},p=async()=>{await J(t.page,t.perPage),t.searchLoading=!0,setTimeout(()=>{t.searchLoading=!1},1100)},A=me("formatDate"),c=I([{name:"ID",label:"SOW ID",align:"left",field:e=>e._id,format:e=>`${e}`,sortable:!0},{name:"name",required:!0,label:"Name",align:"left",field:e=>e.Name,format:e=>`${e}`,sortable:!0,bodyCell:{template:`
          <div @click="$emit('row-click', rowData)">
            {{ rowData.Name }} <br />
            {{ rowData.AccountName}}
          </div>
        `}},{name:"stage",label:"Stage",align:"left",field:e=>e.OpportunityStage},{name:"created_at",label:"Date",align:"left",field:e=>A(e.created_at)},{name:"collaborators",label:"Collaborators"}]),g=d(window.innerWidth),v=()=>{g.value=window.innerWidth,K()};B(()=>{window.addEventListener("resize",v),v()}),pe(()=>{window.removeEventListener("resize",v)});const K=()=>{if(g.value<=500){const e=c.findIndex(o=>o.name==="ID");e!==-1&&c.splice(e,1)}if(g.value<=900){const e=c.findIndex(o=>o.name==="stage");e!==-1&&c.splice(e,1)}else c.find(o=>o.name==="stage")||c.splice(2,0,{name:"stage",label:"Stage",field:o=>o.OpportunityStage,sortable:!0});if(g.value<=1e3){const e=c.findIndex(o=>o.name==="created_at");e!==-1&&c.splice(e,1)}else c.find(o=>o.name==="created_at")||c.splice(3,0,{name:"created_at",label:"Date",field:o=>A(o.created_at),sortable:!0})},G=d(!1),H="secondary",X={width:"50px",height:"32px","text-align":"center"},L=be(),Y=(e,o,r)=>{console.log(r,"event",e,"SOW ID"),r.ctrlKey||r.button===1||r==="openNewTab"?window.open(`sow_details/${e}`,"_blank"):r==="openNewWindow"?window.open(`sow_details/${e}`,"_blank","width=full,height=full"):r==="openIncognitoWindow"?window.open(`sow_details/${e}`,"_blank","incognito=yes"):r.button!==2&&(k.push({name:"SowDetails",params:{id:e}}),L.loading.show({message:"Redirecting to SOW...",spinnerSize:100,spinnerColor:"primary",messageColor:"white",backgroundColor:"primary"}),setTimeout(()=>{L.loading.hide()},900))};function P(e){e!=="close"&&(t.accountID=e.id,t.search="",t.page=1,p())}B(()=>{i.getState.search!==""&&i.setSearch(""),p()});function Z(){t.showMobileSearchExiting=!t.showMobileSearchExiting,t.showMobileSearch===!1?t.showMobileSearch=!0:setTimeout(()=>{t.showMobileSearch=!1},800)}b(()=>i.getState.search,()=>{t.search=i.getState.search,p()});const{result:M,loading:T}=z(ve,()=>({companyName:i.getState.search,page:i.getState.page,first:15})),u=d([]),y=d(!1),$=d("");U(()=>{if(T.value&&(y.value=!0),i.getState.search&&$.value!==i.getState.search&&(y.value=!0,u.value=[],$.value=i.getState.search),M.value){y.value=!1;let e=u.value;const o=M.value.Companies.data.filter(r=>!u.value.some(w=>w.AccountName===r.AccountName));i.getState.page>1?u.value=[...u.value,...o]:u.value=[...o,...u.value],i.setSpinner(u.value,e)}}),i.onSetValueCallback(P);function _(){u.value=[],t.accountID=null,t.search="",t.page=1}return{setSowSearch:P,sows:a,columns:c,loading:G,pagination:D,paginator:N,paginationColor:H,paginationInputStyle:X,handleRowClick:Y,loadSows:p,setPage:j,state:t,windowWidth:g,setShowMobileSearch:Z,userData:l,route:s,accounts:u,isAccountLoading:T,resetAccount:_,darkmode:f}}}),Oe={key:0,class:"flex relative"},ke={class:"absolute right-0 flex flex-col-reverse sm:flex-row"};function De(a,s,k,D,N,W){const f=R("SearchModel"),h=R("ListQTable");return C(),Q(re,null,[S("div",{class:"q-pa-lg",style:{width:"100%"},onClick:s[3]||(s[3]=l=>a.state.hideFabLabels=!0)},[a.windowWidth>500&&a.route.path!=="/client-sows"&&(a.userData.account_id===633||a.userData.account_id===3245)?(C(),Q("div",Oe,[m(oe,{color:"primary",label:"Create SOW","icon-right":"arrow_forward",class:"mb-5 sm:mb-0",to:"/sow/create",onClick:s[0]||(s[0]=l=>a.$router.push("/sow/create"))}),S("div",ke,[m(ge,{modelValue:a.state.showRelatedSOWs,"onUpdate:modelValue":s[1]||(s[1]=l=>a.state.showRelatedSOWs=l),label:"Only Related SOWs",color:"primary",class:"mr-4 dark:text-slate-200",dark:a.darkmode},{default:O(()=>[m(se,{class:"text-sm bg-white border shadow-md text-black"},{default:O(()=>[...s[7]||(s[7]=[ne(" Only show SOWs that have my sales person account associated ",-1)])]),_:1})]),_:1},8,["modelValue","dark"]),m(f,{label:"Accounts",rows:a.accounts,loading:a.isAccountLoading,filled:"",dense:"",value:"companyName",resetSearch:a.resetAccount,"no-focus":""},null,8,["rows","loading","resetSearch"])])])):E("",!0),S("div",{onClick:s[2]||(s[2]=l=>a.state.hideFabLabels=!0)},[m(h,{class:F(a.windowWidth<=500?"mt-[-2rem]":"mt-[1.5rem]"),title:a.route.path!=="/client-sows"?"SOWs":"Client SOWs",rows:a.sows,columns:a.columns,handleRowClick:a.handleRowClick,stateValue:a.state,setPage:a.setPage,loading:a.state.searchLoading,customNoDataText:"Searching for SOWs...",preloadTemplate:""},null,8,["class","title","rows","columns","handleRowClick","stateValue","setPage","loading"])])]),a.windowWidth<=500?(C(),ae(fe,{key:0,color:"primary",icon:"keyboard_arrow_up",direction:"up",class:"h-2 pb-12 pt-3 fixed bottom-0 right-0 mr-8 mb-8"},{default:O(()=>[m(q,{modelValue:a.state.hideFabLabels,"onUpdate:modelValue":s[4]||(s[4]=l=>a.state.hideFabLabels=l),color:a.state.showMobileSearchExiting?"red-5":"secondary",icon:a.state.showMobileSearchExiting?"close":"travel_explore",label:"Search",class:"px-2",onClick:a.setShowMobileSearch},null,8,["modelValue","color","icon","onClick"]),m(q,{modelValue:a.state.hideFabLabels,"onUpdate:modelValue":s[5]||(s[5]=l=>a.state.hideFabLabels=l),color:"primary",label:"Create",icon:"add",onClick:s[6]||(s[6]=l=>a.$router.push("/sow/create"))},null,8,["modelValue"])]),_:1})):E("",!0),te(S("div",{class:F(["bg-primary fixed w-full h-24 bottom-0 flex items-center",a.state.showMobileSearchExiting?"animate__fadeInUp":"animate__fadeOut"]),style:{"animation-duration":"0.8s"}},[m(f,{label:"Accounts",rows:a.accounts,loading:a.isAccountLoading,class:"w-60 mr-20 rounded-full ml-10",filled:"",dense:"",value:"companyName",resetSearch:a.resetAccount,"no-focus":""},null,8,["rows","loading","resetSearch"])],2),[[le,a.state.showMobileSearch&&a.windowWidth<=500]])],64)}const Ze=x(Ce,[["render",De],["__scopeId","data-v-df6c015a"]]);export{Ze as default};
